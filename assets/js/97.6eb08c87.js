(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{503:function(e,s,t){"use strict";t.r(s);var n=t(2),a=Object(n.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"useeffect-与-uselayouteffect-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#useeffect-与-uselayouteffect-的区别"}},[e._v("#")]),e._v(" "),s("code",[e._v("useEffect")]),e._v(" 与 "),s("code",[e._v("useLayoutEffect")]),e._v(" 的区别")]),e._v(" "),s("p",[s("code",[e._v("useEffect")]),e._v(": 用来取代 "),s("code",[e._v("componentDidMount")]),e._v(" 和 "),s("code",[e._v("componentDidUpdate")]),e._v(". 主要作用是当页面渲染后, 进行一些副作用操作(比如访问 "),s("code",[e._v("DOM")]),e._v(", 请求数据)")]),e._v(" "),s("p",[s("code",[e._v("useLayoutEffect")]),e._v(": 作用与 "),s("code",[e._v("useEffect")]),e._v(" 几乎一致.")]),e._v(" "),s("p",[e._v("观察以下两个例子:")]),e._v(" "),s("p",[s("code",[e._v("useEffect")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-react line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import { useEffect, useState } from 'react'\n\nfunction App() {\n  const [msg, setMsg] = useState('hello world')\n\n  useEffect(() => {\n    let i = 0;\n    while(i <= 100000000) {\n      i++;\n    }\n    setMsg(\"world hello\")\n  }, [])\n\n  return (\n    <div>{msg}</div>\n  )\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br")])]),s("p",[s("code",[e._v("useLayoutEffect")]),e._v(":")]),e._v(" "),s("div",{staticClass:"language-react line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("import { useEffect, useState } from 'react'\n\nfunction App() {\n  const [msg, setMsg] = useState('hello world')\n\n  useLayoutEffect(() => {\n    let i = 0;\n    while(i <= 100000000) {\n      i++;\n    }\n    setMsg(\"world hello\")\n  }, [])\n\n  return (\n    <div>{msg}</div>\n  )\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br")])]),s("p",[e._v("可以看出, 使用 "),s("code",[e._v("useEffect")]),e._v(" 在页面中进行 "),s("code",[e._v("msg")]),e._v(" 的值, 页面会有细微的闪烁, 而 "),s("code",[e._v("useLayoutEffect")]),e._v(" 则不会出现闪烁.")]),e._v(" "),s("blockquote",[s("p",[s("code",[e._v("useEffect")]),e._v(" 在渲染完成后异步执行, 先将初始值 "),s("code",[e._v("hello world")]),e._v(" 渲染, 然后异步变成 "),s("code",[e._v("world hello")]),e._v(", 从而导致页面闪烁")])]),e._v(" "),s("blockquote",[s("p",[s("code",[e._v("useLayoutEffect")]),e._v(" 是渲染之前同步完成, 等到执行完成后再进行渲染.")])]),e._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("优先使用 "),s("code",[e._v("useEffect")]),e._v(", 因为异步执行不会阻塞渲染")])]),e._v(" "),s("li",[s("p",[e._v("影响渲染的操作统一放到 "),s("code",[e._v("useLayoutEffect")]),e._v(", 避免页面闪烁")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("useLayoutEffect")]),e._v(" 与 "),s("code",[e._v("componentDidMount")]),e._v(" 等价, 同步调用从而阻塞渲染")])]),e._v(" "),s("li",[s("p",[e._v("在 "),s("code",[e._v("SSR")]),e._v(" 项目中使用 "),s("code",[e._v("useLayoutEffect")]),e._v(" 会出现 "),s("strong",[e._v("warning")]),e._v(", 这是 "),s("code",[e._v("useLayoutEffect")]),e._v(" 只有 "),s("code",[e._v("CSR")]),e._v(" 时才能使用, 这可能导致 "),s("code",[e._v("SSR")]),e._v("渲染的内容与实际不符. 而解决办法就是 "),s("code",[e._v("useIsomorphicLayoutEffect")]),e._v(":")]),e._v(" "),s("blockquote",[s("p",[e._v("Warning: useLayoutEffect does nothing on the server, because its effect cannot be encoded into the server renderer's output format. This will lead to a mismatch between the initial, non-hydrated UI and the intended UI. To avoid this, useLayoutEffect should only be used in components that render exclusively on the client. See https://fb.me/react-uselayouteffect-ssr for common fixes.")])]),e._v(" "),s("div",{staticClass:"language-jsx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" useEffect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" useLayoutEffect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'react'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" useIsomorphicLayoutEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typeof")]),e._v(" window "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!==")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'undefined'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),e._v(" useLayoutEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" useEffect\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" useIsomorphicLayoutEffect\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])])])])])}),[],!1,null,null,null);s.default=a.exports}}]);